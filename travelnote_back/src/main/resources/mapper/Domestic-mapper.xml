<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.iei.Domestic.model.dao.DomesticDao">

    <!-- 지역 리스트 가져오기 -->
    <select id="getAllRegions" resultType="region">
        SELECT reg.*, time_zone, currency_code
        FROM (SELECT * FROM (SELECT ROWNUM AS rnum, r.* FROM
        (SELECT * FROM region WHERE country_name != '국가명' ORDER BY region_no DESC) r)
        WHERE rnum BETWEEN #{startNum} AND #{endNum}) reg
        LEFT JOIN region_info ON reg.region_no = region_info.region_no
    </select>

    <!-- 일정 저장 -->
    <insert id="saveItinerary">
        INSERT INTO itinerary (itinerary_no, user_no, region_no, itinerary_start_date, itinerary_end_date, itinerary_title)
        VALUES (itinerary_no_seq.NEXTVAL, 
            (SELECT user_no FROM user_tbl WHERE user_email = #{userEmail}), 
            #{regionNo}, #{itineraryStartDate}, #{itineraryEndDate}, #{itineraryTitle})
        <selectKey resultType="int" keyProperty="itineraryNo" order="AFTER">
            SELECT MAX(itinerary_no) FROM itinerary
        </selectKey>
    </insert>

   

    <!-- 일정 조회 메서드 (추가된 기능) -->
    <select id="selectItinerary" resultType="itinerary">
      select i.*, region_name, country_name from 
		(select itinerary_no, region_no, itinerary_start_date, itinerary_end_date, itinerary_title from itinerary where itinerary_no = #{itineraryNo})i
		join (region)r on i.region_no = r.region_no
    </select>

    <!-- 여행지 정보 조회 -->
    <select id="selectRegion" resultType="Region">
        SELECT r.region_no, r.region_name, r.country_name, r.region_img
        FROM region r
        WHERE r.region_no = #{regionNo}
    </select>
    
    <select id="selectPlan" resultType="Plan">
		select * from plan where itinerary_no = #{itineraryNo} and plan_day = #{planDay}
	</select>
	
</mapper>